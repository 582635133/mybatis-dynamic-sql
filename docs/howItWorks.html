<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.7.4 at 10 December 2017 
 | Rendered using Apache Maven Fluido Skin 1.6
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20171210" />
    <meta http-equiv="Content-Language" content="en" />
    <title>MyBatis Dynamic SQL &#x2013; How it Works</title>
    <link rel="stylesheet" href="../css/apache-maven-fluido-1.6.min.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />
      <script type="text/javascript" src="../js/apache-maven-fluido-1.6.min.js"></script>
      </head>
    <body class="topBarDisabled">
      <div class="container-fluid">
      <div id="banner">
        <div class="pull-left"><a href="../docs/introduction.html" id="bannerLeft"><h2>MyBatis Dynamic SQL</h2>
</a></div>
        <div class="pull-right"><a href="../../" id="bannerRight" title="MyBatis logo"><img src="http://mybatis.github.io/images/mybatis-logo.png"  alt="MyBatis logo"/></a></div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
        <li id="publishDate">Last Published: 10 December 2017<span class="divider">|</span>
</li>
          <li id="projectVersion">Version: 1.0.0-SNAPSHOT</li>
        </ul>
      </div>
      <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
<ul class="nav nav-list">
          <li class="nav-header">User's Guide</li>
    <li><a href="../docs/introduction.html" title="Introduction"><span class="none"></span>Introduction</a>  </li>
    <li><a href="../docs/quickStart.html" title="Quick Start"><span class="none"></span>Quick Start</a>  </li>
    <li><a href="../docs/whereClauses.html" title="WHERE Clause Support"><span class="none"></span>WHERE Clause Support</a>  </li>
    <li><a href="../docs/select.html" title="SELECT Statements"><span class="none"></span>SELECT Statements</a>  </li>
    <li><a href="../docs/delete.html" title="DELETE Statements"><span class="none"></span>DELETE Statements</a>  </li>
    <li><a href="../docs/insert.html" title="INSERT Statements"><span class="none"></span>INSERT Statements</a>  </li>
    <li><a href="../docs/update.html" title="UPDATE Statements"><span class="none"></span>UPDATE Statements</a>  </li>
    <li><a href="../docs/mybatis3.html" title="MyBatis3 Support"><span class="none"></span>MyBatis3 Support</a>  </li>
    <li><a href="../docs/spring.html" title="Spring Support"><span class="none"></span>Spring Support</a>  </li>
    <li class="active"><a href="#"><span class="none"></span>How it Works</a>
  </li>
    <li><a href="../docs/extending.html" title="Extending the Library"><span class="none"></span>Extending the Library</a>  </li>
    <li><a href="../docs/codingStandards.html" title="Coding Standards"><span class="none"></span>Coding Standards</a>  </li>
    <li><a href="../docs/motivation.html" title="Motivation"><span class="none"></span>Motivation</a>  </li>
          <li class="nav-header">Project Documentation</li>
    <li><a href="../project-info.html" title="Project Information"><span class="icon-chevron-right"></span>Project Information</a>  </li>
    <li><a href="../project-reports.html" title="Project Reports"><span class="icon-chevron-right"></span>Project Reports</a>  </li>
  </ul>
          <hr />
          <div id="poweredBy">
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
  <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="../images/logos/maven-feather.png" /></a>
              </div>
          </div>
        </div>
        <div id="bodyColumn"  class="span10" >
<h1>How it Works</h1>
<p>MyBatis does four main things:</p>

<ol style="list-style-type: decimal">
  
<li>It executes SQL in a safe way and abstracts away all the intricacies of JDBC</li>
  
<li>It maps parameter objects to JDBC prepared statement parameters</li>
  
<li>It maps rows in JDBC result sets to objects</li>
  
<li>It can generate dynamic SQL with special tags in XML, or through the use of various templating engines</li>
</ol>
<p>This library takes full advantage of the first three capabilities in MyBatis and essentially becomes another templating engine for generating dynamic SQL.</p>
<p>For example, MyBatis can execute an SQL string formatted like this:</p>

<div class="source">
<div class="source"><pre class="prettyprint">  select id, description from table_codes where id = #{id,jdbcType=INTEGER} 
</pre></div></div>
<p>This is standard SQL with a MyBatis twist - the parameter notation <tt>#{id,jdbcType=INTEGER}</tt> tells MyBatis to take the <tt>id</tt> property of a parameter object and use it as a JDBC prepared statement parameter.</p>
<p>Now suppose we have two Java classes like this:</p>

<div class="source">
<div class="source"><pre class="prettyprint">public class TableCode {
  private Integer id;
  private String description;
  ... getters/setters
}

public class Parameter {
  private String sql = &quot;select id, description from table_codes where id = #{id,jdbcType=INTEGER}&quot;;
  private Integer id;

  public Parameter(Integer id) {
    this.id = id;
  }
  
  public Integer getId() {
    return id;
  }
  
  public String getSql() {
    return sql;
  }
}
</pre></div></div>
<p>These classes can be used in conjunction with a MyBatis mapper like this:</p>

<div class="source">
<div class="source"><pre class="prettyprint">public interface Mapper {

  @Select({
    &quot;${sql}&quot;
  })
  TableCode getTableCode(Parameter parameter);
}
</pre></div></div>
<p>Using this mapper with MyBatis looks like this:</p>

<div class="source">
<div class="source"><pre class="prettyprint">  SqlSession sqlSession = sqlSessionFactory.openSession();
  try {
    Mapper mapper = sqlSession.getMapper(Mapper.class);
    Parameter parameter = new Parameter(2);
    TableCode tableCode = mapper.getTableCode(parameter);
    assertThat(tableCode.getId()).isEqualTo(2);
  } finally {
    sqlSession.close();
  }
</pre></div></div>
<p>The parameter object has a property called <tt>sql</tt>. That SQL string will be prepared as a JDBC prepared statement in MyBatis. The SQL string also references a property called <tt>id</tt>. That property - from the same parameter object - will be used as the value of the prepared statement parameter.</p>
<p>So the main idea is this - this library builds a version of the <tt>Parameter</tt> class shown above. The class includes the full SQL statement to execute, formatted for MyBatis, and any parameters referenced by the statement. There are different versions of these classes for the different types of SQL statements. But in every case, the class is designed to be the one single parameter for a MyBatis mapper method.</p>
<div class="section">
<h2><a name="What_About_SQL_Injection"></a>What About SQL Injection?</h2>
<p>It is true that mappers written this way are open to SQL injection. But this is also true of using any of the various SQL provider classes in MyBatis (<tt>@SelectProvider</tt>, etc.) So you must be careful that these types of mappers are not exposed to any general user input.</p>
<p>If you follow these practices, you will lower the risk of SQL injection:</p>

<ol style="list-style-type: decimal">
  
<li>Always use MyBatis annotated mappers</li>
  
<li>Use the <tt>SqlProviderAdapter</tt> utility class in conjunction with the MyBatis provider annotations (<tt>@InsertProvider</tt>, <tt>@SelectProvider</tt>, etc.)</li>
</ol></div>
        </div>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>Copyright &copy;2016&#x2013;2017
<a href="http://www.mybatis.org/">MyBatis.org</a>.
All rights reserved.</p>
        </div>
        </div>
    </footer>
    </body>
</html>

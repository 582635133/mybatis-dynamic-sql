<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.7.4 at 10 December 2017 
 | Rendered using Apache Maven Fluido Skin 1.6
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20171210" />
    <meta http-equiv="Content-Language" content="en" />
    <title>MyBatis Dynamic SQL &#x2013; Select Statements</title>
    <link rel="stylesheet" href="../css/apache-maven-fluido-1.6.min.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />
      <script type="text/javascript" src="../js/apache-maven-fluido-1.6.min.js"></script>
      </head>
    <body class="topBarDisabled">
      <div class="container-fluid">
      <div id="banner">
        <div class="pull-left"><a href="../docs/introduction.html" id="bannerLeft"><h2>MyBatis Dynamic SQL</h2>
</a></div>
        <div class="pull-right"><a href="../../" id="bannerRight" title="MyBatis logo"><img src="http://mybatis.github.io/images/mybatis-logo.png"  alt="MyBatis logo"/></a></div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
        <li id="publishDate">Last Published: 10 December 2017<span class="divider">|</span>
</li>
          <li id="projectVersion">Version: 1.0.0-SNAPSHOT</li>
        </ul>
      </div>
      <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
<ul class="nav nav-list">
          <li class="nav-header">User's Guide</li>
    <li><a href="../docs/introduction.html" title="Introduction"><span class="none"></span>Introduction</a>  </li>
    <li><a href="../docs/quickStart.html" title="Quick Start"><span class="none"></span>Quick Start</a>  </li>
    <li><a href="../docs/whereClauses.html" title="WHERE Clause Support"><span class="none"></span>WHERE Clause Support</a>  </li>
    <li class="active"><a href="#"><span class="none"></span>SELECT Statements</a>
  </li>
    <li><a href="../docs/delete.html" title="DELETE Statements"><span class="none"></span>DELETE Statements</a>  </li>
    <li><a href="../docs/insert.html" title="INSERT Statements"><span class="none"></span>INSERT Statements</a>  </li>
    <li><a href="../docs/update.html" title="UPDATE Statements"><span class="none"></span>UPDATE Statements</a>  </li>
    <li><a href="../docs/mybatis3.html" title="MyBatis3 Support"><span class="none"></span>MyBatis3 Support</a>  </li>
    <li><a href="../docs/spring.html" title="Spring Support"><span class="none"></span>Spring Support</a>  </li>
    <li><a href="../docs/howItWorks.html" title="How it Works"><span class="none"></span>How it Works</a>  </li>
    <li><a href="../docs/extending.html" title="Extending the Library"><span class="none"></span>Extending the Library</a>  </li>
    <li><a href="../docs/codingStandards.html" title="Coding Standards"><span class="none"></span>Coding Standards</a>  </li>
    <li><a href="../docs/motivation.html" title="Motivation"><span class="none"></span>Motivation</a>  </li>
          <li class="nav-header">Project Documentation</li>
    <li><a href="../project-info.html" title="Project Information"><span class="icon-chevron-right"></span>Project Information</a>  </li>
    <li><a href="../project-reports.html" title="Project Reports"><span class="icon-chevron-right"></span>Project Reports</a>  </li>
  </ul>
          <hr />
          <div id="poweredBy">
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
  <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="../images/logos/maven-feather.png" /></a>
              </div>
          </div>
        </div>
        <div id="bodyColumn"  class="span10" >
<h1>Select Statements</h1>
<p>Select statements are the most complex SQL statements. This library duplicates the syntax of the most common select statements, but purposely does not cover every possibility.</p>
<p>In general, the following are supported:</p>

<ol style="list-style-type: decimal">
  
<li>The typical parts of a select statement including SELECT, DISTINCT, FROM, JOIN, WHERE, GROUP BY, UNION,  ORDER BY</li>
  
<li>Tables can be aliased per select statement</li>
  
<li>Columns can be aliased per select statement</li>
  
<li>Some support for aggregates (avg, min, max, sum)</li>
  
<li>Equijoins of type INNER, LEFT OUTER, RIGHT OUTER, FULL OUTER</li>
  
<li>Subqueries in where clauses. For example, <tt>where foo in (select foo from foos where id &lt; 36)</tt></li>
</ol>
<p>At this time, the library does not support the following:</p>

<ol style="list-style-type: decimal">
  
<li>WITH expressions</li>
  
<li>HAVING expressions</li>
  
<li>Select from another select. For example <tt>select count(*) from (select foo from foos where id &lt; 36)</tt></li>
  
<li>INTERSECT, EXCEPT, etc.</li>
</ol>
<p>The user guide page for WHERE Clauses shows examples of many different types of SELECT statements with different complexities of the WHERE clause including support for sub-queries. We will just show a single example here, including an ORDER BY clause:</p>

<div class="source">
<div class="source"><pre class="prettyprint">    SelectStatement selectStatement = select(id, animalName, bodyWeight, brainWeight)
            .from(animalData)
            .where(id, isIn(1, 5, 7))
            .and(bodyWeight, isBetween(1.0).and(3.0))
            .orderBy(id.descending(), bodyWeight)
            .build()
            .render(RenderingStrategy.MYBATIS3);

    List&lt;AnimalData&gt; animals = mapper.selectMany(selectStatement);
</pre></div></div>
<p>The WHERE and ORDER BY clauses are optional.</p>
<div class="section">
<h2><a name="Joins"></a>Joins</h2>
<p>The library supports the generation of equijoin statements - joins defined by column matching. For example:</p>

<div class="source">
<div class="source"><pre class="prettyprint">    SelectStatement selectStatement = select(orderMaster.orderId, orderDate, orderDetail.lineNumber, orderDetail.description, orderDetail.quantity)
            .from(orderMaster, &quot;om&quot;)
            .join(orderDetail, &quot;od&quot;).on(orderMaster.orderId, equalTo(orderDetail.orderId))
            .build()
            .render(RenderingStrategy.MYBATIS3);
</pre></div></div>
<p>Notice that you can give an alias to a tables if desired. If you don&#x2019;t specify an alias, the full table name wil be used in the generated SQL.</p>
<p>Multiple tables can be joined in a single statement. For example:</p>

<div class="source">
<div class="source"><pre class="prettyprint">    SelectStatement selectStatement = select(orderMaster.orderId, orderDate, orderLine.lineNumber, itemMaster.description, orderLine.quantity)
            .from(orderMaster, &quot;om&quot;)
            .join(orderLine, &quot;ol&quot;).on(orderMaster.orderId, equalTo(orderLine.orderId))
            .join(itemMaster, &quot;im&quot;).on(orderLine.itemId, equalTo(itemMaster.itemId))
            .where(orderMaster.orderId, isEqualTo(2))
            .build()
            .render(RenderingStrategy.MYBATIS3);
</pre></div></div>
<p>Join queries will likely require you to define a MyBatis result mapping in XML. This is the only instance where XML is required. This is due to the limitations of the MyBatis annotations when mapping collections.</p>
<p>The library supports four join types:</p>

<ol style="list-style-type: decimal">
  
<li><tt>.join(...)</tt> is an INNER join</li>
  
<li><tt>.leftJoin(...)</tt> is a LEFT OUTER join</li>
  
<li><tt>.rightJoin(...)</tt> is a RIGHT OUTER join</li>
  
<li><tt>.fullJoin(...)</tt> is a FULL OUTER join</li>
</ol></div>
<div class="section">
<h2><a name="Union_Queries"></a>Union Queries</h2>
<p>The library supports the generation of UNION queries. Foe example:</p>

<div class="source">
<div class="source"><pre class="prettyprint">    SelectStatement selectStatement = select(id, animalName, bodyWeight, brainWeight)
            .from(animalData)
            .union()
            .selectDistinct(id, animalName, bodyWeight, brainWeight)
            .from(animalData)
            .orderBy(id)
            .build()
            .render(RenderingStrategy.MYBATIS3);
</pre></div></div>
<p>Any number of SELECT statements can be added to a UNION query. Only one ORDER BY phrase is allowed.</p></div>
<div class="section">
<h2><a name="Annotated_Mapper_for_Select_Statements"></a>Annotated Mapper for Select Statements</h2>
<p>The SelectStatement object can be used as a parameter to a MyBatis mapper method directly. If you are using an annotated mapper, the select method should look like this (note that we recommend coding a &#x201c;selectMany&#x201d; and a &#x201c;selectOne&#x201d; method with a shared result mapping):</p>

<div class="source">
<div class="source"><pre class="prettyprint">import org.apache.ibatis.annotations.Result;
import org.apache.ibatis.annotations.ResultMap;
import org.apache.ibatis.annotations.Results;
import org.apache.ibatis.annotations.SelectProvider;
import org.mybatis.dynamic.sql.select.render.SelectStatement;
import org.mybatis.dynamic.sql.util.SqlProviderAdapter;

...
    @SelectProvider(type=SqlProviderAdapter.class, method=&quot;select&quot;)
    @Results(id=&quot;AnimalDataResult&quot;, value={
        @Result(column=&quot;id&quot;, property=&quot;id&quot;, id=true),
        @Result(column=&quot;animal_name&quot;, property=&quot;animalName&quot;),
        @Result(column=&quot;brain_weight&quot;, property=&quot;brainWeight&quot;),
        @Result(column=&quot;body_weight&quot;, property=&quot;bodyWeight&quot;)
    })
    List&lt;AnimalData&gt; selectMany(SelectStatement selectStatement);

    @SelectProvider(type=SqlProviderAdapter.class, method=&quot;select&quot;)
    @ResultMap(&quot;AnimalDataResult&quot;)
    AnimalData selectOne(SelectStatement selectStatement);
...

</pre></div></div></div>
<div class="section">
<h2><a name="XML_Mapper_for_Join_Statements"></a>XML Mapper for Join Statements</h2>
<p>If you are coding a join, it is likely you will need to code an XML mapper to define the result map. This is due to a MyBatis limitation - the annotations cannot define a collection mapping. If you have to do this, the Java code looks like this:</p>

<div class="source">
<div class="source"><pre class="prettyprint">    @SelectProvider(type=SqlProviderAdapter.class, method=&quot;select&quot;)
    @ResultMap(&quot;SimpleJoinResult&quot;)
    List&lt;OrderMaster&gt; selectMany(SelectStatement selectStatement);
</pre></div></div>
<p>And the corresponding XML looks like this:</p>

<div class="source">
<div class="source"><pre class="prettyprint">&lt;mapper namespace=&quot;examples.joins.JoinMapper&quot;&gt;
  &lt;resultMap id=&quot;SimpleJoinResult&quot; type=&quot;examples.joins.OrderMaster&quot;&gt;
    &lt;id column=&quot;order_id&quot; jdbcType=&quot;INTEGER&quot; property=&quot;id&quot; /&gt;
    &lt;result column=&quot;order_date&quot; jdbcType=&quot;DATE&quot; property=&quot;orderDate&quot; /&gt;
    &lt;collection property=&quot;details&quot; ofType=&quot;examples.joins.OrderDetail&quot;&gt;
      &lt;id column=&quot;order_id&quot; jdbcType=&quot;INTEGER&quot; property=&quot;orderId&quot;/&gt;
      &lt;id column=&quot;line_number&quot; jdbcType=&quot;INTEGER&quot; property=&quot;lineNumber&quot;/&gt;
      &lt;result column=&quot;description&quot; jdbcType=&quot;VARCHAR&quot; property=&quot;description&quot;/&gt;
      &lt;result column=&quot;quantity&quot; jdbcType=&quot;INTEGER&quot; property=&quot;quantity&quot;/&gt;
    &lt;/collection&gt;
  &lt;/resultMap&gt;
&lt;/mapper&gt;
</pre></div></div>
<p>Notice that the resultMap is the only element in the XML mapper. This is our recommended practice.</p></div>
<div class="section">
<h2><a name="XML_Mapper_for_Select_Statements"></a>XML Mapper for Select Statements</h2>
<p>We do not recommend using an XML mapper for select statements, but if you want to do so the SelectStatement object can be used as a parameter to a MyBatis mapper method directly.</p>
<p>If you are using an XML mapper, the select method should look like this in the Java interface:</p>

<div class="source">
<div class="source"><pre class="prettyprint">import org.mybatis.dynamic.sql.select.render.SelectStatement;

...
    List&lt;AnimalData&gt; selectMany(SelectStatement selectStatement);
...

</pre></div></div>
<p>The XML element should look like this:</p>

<div class="source">
<div class="source"><pre class="prettyprint">  &lt;resultMap id=&quot;animalResult&quot; type=&quot;examples.animal.data.AnimalData&quot;&gt;
    &lt;id column=&quot;id&quot; jdbcType=&quot;INTEGER&quot; property=&quot;id&quot; /&gt;
    &lt;result column=&quot;animal_name&quot; jdbcType=&quot;VARCHAR&quot; property=&quot;animalName&quot; /&gt;
    &lt;result column=&quot;brain_weight&quot; jdbcType=&quot;DOUBLE&quot; property=&quot;brainWeight&quot; /&gt;
    &lt;result column=&quot;body_weight&quot; jdbcType=&quot;DOUBLE&quot; property=&quot;bodyWeight&quot; /&gt;
  &lt;/resultMap&gt;

  &lt;select id=&quot;selectMany&quot; resultMap=&quot;animalResult&quot;&gt;
    ${selecteStatement}
  &lt;/select&gt;
</pre></div></div></div>
<div class="section">
<h2><a name="Notes_on_Order_By"></a>Notes on Order By</h2>
<p>Order by phrases can be difficult to calculate when there are aliased columns, aliased tables, unions, and joins. This library has taken a simple approach - the library will either write the column alias or the column name into the order by phrase. For the order by phrase, the table alias (if there is one) will be ignored.</p>
<p>In our testing, this caused an issue in only one case. When there is an outer join and the select list contains both the left and right join column. In that case, the workaround is to supply a column alias for both columns.</p>
<p>When using a column function (lower, upper, etc.), then is is customary to give the calculated column an alias so you will have a predictable result set. In cases like this there will not be a column to use for an alias. The library supports arbitrary values in an ORDER BY expression like this:</p>

<div class="source">
<div class="source"><pre class="prettyprint">    SelectStatement selectStatement = select(substring(gender, 1, 1).as(&quot;ShortGender&quot;), avg(age).as(&quot;AverageAge&quot;))
            .from(person, &quot;a&quot;)
            .groupBy(substring(gender, 1, 1))
            .orderBy(sortColumn(&quot;ShortGender&quot;).descending())
            .build()
            .render(RenderingStrategy.MYBATIS3);
</pre></div></div>
<p>In this example the <tt>substring</tt> function is used in both the select list and the GROUP BY expression. In the ORDER BY expression, we use the <tt>sortColumn</tt> function to duplicate the alias given to the column in the select list.</p></div>
        </div>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>Copyright &copy;2016&#x2013;2017
<a href="http://www.mybatis.org/">MyBatis.org</a>.
All rights reserved.</p>
        </div>
        </div>
    </footer>
    </body>
</html>
